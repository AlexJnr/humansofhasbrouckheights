(function(){var mainBust=3;var seriesBust=1;var countriesBust=2;var mainCache=.5;var mainSolidCache=48;var seriesCache=360;var countriesCache=360;var mainRequestSize=12;var mainUrl="https://be1uo0y30d.execute-api.us-east-1.amazonaws.com/prod/data?limit=12";var countryRequestSize=50;var countryUrl="https://be1uo0y30d.execute-api.us-east-1.amazonaws.com/prod/data?limit=45";HONY.dataStore={};HONY.dataStore.series={};HONY.dataStore.countries={};HONY.dataStore.main={};var mainDataModel={cacheVersion:mainBust,timeStamp:(new Date).getTime(),list:[],posts:{}};var countryDataModel={cacheVersion:countriesBust,timeStamp:(new Date).getTime(),list:{},countries:{}};function init(){var mainStorageTest=localStorage.getItem("HONY-MAIN");if(mainStorageTest){HONY.dataStore.main=JSON.parse(mainStorageTest);if(!HONY.dataStore.main["cacheVersion"]||HONY.dataStore.main["cacheVersion"]!==mainBust){HONY.dataStore.main=mainDataModel}else{var timeDifferenceInHours=((new Date).getTime()-HONY.dataStore.main.timeStamp)/1e3/60/60;console.log(timeDifferenceInHours);if(timeDifferenceInHours>mainCache){console.log("Data is over an hour old, lets get it again.");HONY.dataStore.main=mainDataModel}}}else{HONY.dataStore.main=mainDataModel}var countryStorageTest=localStorage.getItem("HONY-COUNTRIES");if(countryStorageTest){HONY.dataStore.countries=JSON.parse(countryStorageTest);if(!HONY.dataStore.countries["cacheVersion"]||HONY.dataStore.countries["cacheVersion"]!==countriesBust){HONY.dataStore.countries=countryDataModel}else{var timeDifferenceInHours=((new Date).getTime()-HONY.dataStore.countries.timeStamp)/1e3/60/60;if(timeDifferenceInHours>countriesCache){console.log("Data is over an hour old, lets get it again.");HONY.dataStore.countries=countryDataModel}}}else{HONY.dataStore.countries=countryDataModel}}HONY.dataStore.getCountryData=function(country,callback){var countryPosts=HONY.dataStore.countries.countries;if(countryPosts[country]){console.log("Checked to see if we have the country data, we do!");var returnData=[];var keys=Object.keys(countryPosts[country]);for(var i=0;i<keys.length;i++){returnData.push(countryPosts[country][keys[i]])}console.log("returning this data!",returnData);callback(returnData)}else{console.log("Loading the country data!");var url=countryUrl+"&tag="+country.split(" ").join("-");$.ajax({url:url,dataType:"jsonp",success:function(data){var reversedData=data.response.posts.reverse();HONY.dataStore.saveCountryData(country,reversedData);callback(reversedData)},error:function(data){console.log("error: ",data)}})}};HONY.dataStore.getCountryPostData=function(id,country,callback){var setData=HONY.dataStore.countries.countries[country];if(setData){callback(setData[id]);return}else{console.log("NO COUNTRY POST DATA")}};HONY.dataStore.getCountryRelavent=function(id,country,callback){var setData=HONY.dataStore.countries.countries[country];var relavent=[];if(setData){var keys=Object.keys(setData);for(var i=0;i<keys.length;i++){if(Number(keys[i])!==id){relavent.push(setData[keys[i]])}}callback(relavent)}else{HONY.dataStore.getMainData(0,12,callback)}};HONY.dataStore.getSeriesData=function(series){};HONY.dataStore.getSeriesRelavent=function(series,id){};HONY.dataStore.getSinglePostData=function(id,callback){var offset=HONY.dataStore.getOffset(id);if(offset!==-1){console.log("We have the single post data!");callback(HONY.dataStore.main.posts[id])}else{console.log("Retrieving the single post data");var url=mainUrl+"&id="+id;$.ajax({url:url,dataType:"jsonp",success:function(data){callback(data.response.posts[0])},error:function(data){console.log("Error retrieving post: ",data)}})}};HONY.dataStore.getMainData=function(offset,amount,callback){var dataPosts=HONY.dataStore.main.posts;var dataList=HONY.dataStore.main.list;if(dataList.length>=offset+amount){var returnData=[];for(var i=offset;i<offset+amount;i++){var postId=dataList[i];returnData.push(dataPosts[postId])}callback(returnData)}else{var url=mainUrl+"&offset="+offset;$.ajax({url:url,dataType:"jsonp",success:function(data){HONY.dataStore.saveMainData(data);callback(data.response.posts)},error:function(data){console.log("error: ",data)}})}};HONY.dataStore.getMainRelavent=function(id,callback){var index=HONY.dataStore.getOffset(id);if(index!==-1){HONY.dataStore.getMainData(index+1,12,callback)}else{HONY.dataStore.getMainData(0,12,callback)}};HONY.dataStore.getOffset=function(id){var index=HONY.dataStore.main.list.indexOf(id);return index};HONY.dataStore.isCountryPost=function(id){if(HONY.dataStore.countries.list[id]){return HONY.dataStore.countries.list[id]}return false};HONY.dataStore.saveCountryData=function(country,posts){var saveSet={};for(var i=0;i<posts.length;i++){var post=posts[i];var postData={post_url:post.post_url,id:post.id,slug:post.slug,caption:post.caption,photos:post.photos,tags:post.tags};saveSet[post.id]=postData;HONY.dataStore.countries.list[post.id]=country}HONY.dataStore.countries.countries[country]=saveSet;localStorage.setItem("HONY-COUNTRIES",JSON.stringify(HONY.dataStore.countries))};HONY.dataStore.saveMainData=function(data){var posts=data.response.posts;for(var i=0;i<posts.length;i++){var post=posts[i];if(HONY.dataStore.main.list.indexOf(post.id)==-1){HONY.dataStore.main.list.push(post.id)}HONY.dataStore.main.posts[post.id]={post_url:post.post_url,id:post.id,slug:post.slug,caption:post.caption,photos:post.photos,tags:post.tags}}localStorage.setItem("HONY-MAIN",JSON.stringify(HONY.dataStore.main))};init()})();var mapData=[["Pakistan","pakistan","pakistan"],["Iran","iran","iranislamicrepublicof"],["Iraq","iraq","iraq"],["Jordan","jordan","jordan"],["Uganda","uganda","uganda"],["DR Congo","democratic republic of congo","congothedemocraticrepublicofthe"],["South Sudan","south sudan","southsudan"],["Kenya","kenya","kenya"],["Ukraine","ukraine","ukraine"],["India","india","india"],["Vietnam","vietnam","vietnam"],["Mexico","mexico","mexico"],["Jerusalem","jerusalem","israel"]];var countryNames={pakistan:"Pakistan",iran:"Iran",iraq:"Iraq",jordan:"Jordan",uganda:"Uganda","democratic-republic-of-congo":"DR Congo","south-sudan":"South Sudan",kenya:"Kenya",ukraine:"Ukraine",india:"India",vietnam:"Vietnam",mexico:"Mexico",jerusalem:"Jerusalem"};(function(){HONY.TemplateController={};HONY.templates={};HONY.TemplateController.init=function(){createTemplates();setTimeout(tearDownPage,0)};function createTemplates(){var $templateObjects=$(".template");for(var i=0;i<$templateObjects.length;i++){var $template=$($templateObjects[i]);HONY.templates[$template.attr("id")]=$template.html()}}function tearDownPage(){cedexis=null;$("iframe").remove();$(".template").remove()}})();function checkFacebook(){setTimeout(function(){if(typeof FB!=="undefined"){FB.XFBML.parse(document.querySelector(".hangin-left"))}},100)}function fbs_click(text,image,name){FB.ui({method:"feed",link:"http://humansofnewyork.com"+window.location.pathname,name:name,caption:"Humans of New York",description:text,picture:image},function(response){})}function manageStickyNav(){window.onscroll=function(e){if(window.scrollY>0){$(".sticky-nav").addClass("active")}else{$(".sticky-nav").removeClass("active")}};setTimeout(function(){$(".burger").click(function(){if($(".mobile-navigation").length){$(".mobile-navigation").remove();$(".burger").removeClass("be-an-x")}else{var $template=$(templates["mobile-navigation"]);$(document.body).append($template);$(".burger").addClass("be-an-x")}})},1)}function hasSeriesTag(tags){for(var i=0;i<tags.length;i++){var tag=tags[i];if(storyPageData[tag]){return tag}}return false}function isSeriesTag(tag){tag=tag.split("-").join(" ");if(storyPageData[tag]){return true}return false}function isMapTag(tag){for(var i=0;i<mapData.length;i++){if(mapData[i][1].split(" ").join("-")===tag.toLowerCase()){return true}}return false}function capitalizeEachWord(str){return str.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()})}function renderSharer(text,image,name){var shortenedText=text.substring(0,100)+"...";var $template=$(templates["share-modal"]);$(".twitter",$template).attr("href","http://twitter.com/share?url="+encodeURIComponent(window.location.href)+";text="+shortenedText+";hashtags=hony");$(".email",$template).attr("href",'mailto:?subject="'+shortenedText+'"&body=On Humans of new York - '+encodeURIComponent(window.location.href));$(".main-wrapper").append($template);$(".hony-wrapper").append($template);$body=$(document.body);$body.off("click",".share-with-friends");$body.on("click",".share-with-friends",function(e){e.preventDefault();$(document.body).addClass("show-share")});$body.off("click",".share-button");$body.on("click",".share-button",function(e){e.preventDefault();$(document.body).addClass("show-share")});$body.off("click",".share-modal-overlay");$body.on("click touchstart",".share-modal-overlay",function(){$(document.body).removeClass("show-share")});$body.off("click",".facebook");$body.on("click",".facebook",function(){fbs_click(text,image,name)});$body.off("click",".twitter");$body.on("click",".twitter",function(e){e.preventDefault();intWidth=500;intHeight=300;strResize="yes";leftPosition=window.screen.width/2-(intWidth/2+10);topPosition=window.screen.height/2-(intHeight/2+50);var strTitle="Syrian Americans on Humans of New York",strParam="width="+intWidth+",height="+intHeight+",resizable="+strResize+",top"+topPosition+",left"+leftPosition+",screenX="+leftPosition+",screenY="+topPosition,objWindow=window.open($(this).attr("href"),strTitle,strParam).focus()})}(function(){HONY.AjaxController={};HONY.data={};HONY.data.posts={};HONY.data.tagged={};HONY.AjaxController.request=function(requestInfo){return null};HONY.AjaxController.saveData=function(data,type){if(type==="posts"){for(var i=0;i<data.length;i++){savePost(data[i])}}else if(type==="post"){savePost(data)}else if(type==="tagged"){}localStorage.setItem("HONY-DATA",JSON.stringify(HONY.data))};HONY.AjaxController.getPost=function(id){if(HONY.data.posts[id]){return HONY.data.posts[id]}else{return false}};function init(){}function savePost(post){HONY.data.posts[post.id]={post_url:post.post_url,id:post.id,slug:post.slug,caption:post.caption,photos:post.photos,tags:post.tags}}init()})();(function(){var page="";HONY.NavigationController={};HONY.NavigationController.getPage=function(url){if(url===undefined){url=window.location.pathname}return determinePage(url)};function determinePage(url){if(url==="/"){return{page:"root"}}url=url.split("/");if(url[1]==="tagged"){var theTag=url[2];if(isSeriesTag(theTag)){return{page:"seriesPage",data:theTag}}else if(isMapTag(theTag)){return{page:"countryPage",data:theTag}}}if(url[1]==="post"){return{page:"post",data:Number(url[2])}}if(url[1]==="series"){return{page:"series"}}if(url[1]==="countries"){return{page:"map"}}if(url[1]==="about"){return{page:"about"}}}function init(){}init()})();(function(){var history=[];HONY.renderingController={};HONY.renderingController.init=function(){setTimeout(function(){handlePopStates()},2e3);handleLinks();renderWrapper()};HONY.renderingController.renderPost=function(postId,country){fadeCurrentPage();HONY.postRenderer.renderPost(postId,country)};HONY.renderingController.render=function(){fadeCurrentPage();var page=HONY.NavigationController.getPage();HONY.renderingController.renderNeededPage(page)};HONY.renderingController.renderNeededPage=function(pageData){if(pageData.page==="root"){HONY.HomeRenderer.renderHome()}else if(pageData.page==="post"){HONY.postRenderer.renderPost(pageData.data)}else if(pageData.page==="series"){HONY.seriesHomeRenderer.render()}else if(pageData.page==="seriesPage"){HONY.storiesRenderer.render()}else if(pageData.page==="countryPage"){HONY.countryRenderer.render(pageData.data)}else if(pageData.page==="map"){HONY.mapRenderer.render()}else if(pageData.page==="about"){HONY.aboutRenderer.render()}};function handleLinks(){$(document.body).on("click",".sticky-nav .hangin-left a, .header-nav a.hony, .header-nav a.more-stuff, .home-header .countries-header, .series-header, .more-stories, .mobile-navigation a, .main-title",function(e){e.preventDefault();var target=e.currentTarget;var targetURL=$(target).attr("href");var page=HONY.NavigationController.getPage(targetURL);$(document.body).addClass("fadeout");setTimeout(function(){fadeCurrentPage();var theUrl=targetURL;var thePage=page;var state={scrollTop:$(window).scrollTop()};window.history.replaceState(state,null,window.location.pathName);$("html, body").scrollTop(0);window.history.pushState(state,null,theUrl);HONY.renderingController.renderNeededPage(thePage);$(document.body).removeClass("fadeout")},400)})}function handlePopStates(event){window.addEventListener("popstate",function(eventX){eventX.preventDefault();var theEvent=eventX;var currentState=theEvent.state;$(document.body).addClass("hidden");fadeCurrentPage();var page=HONY.NavigationController.getPage();HONY.renderingController.renderNeededPage(page);setTimeout(function(){if(currentState&&currentState.scrollTop){$("html, body").scrollTop(currentState.scrollTop)}$(document.body).removeClass("hidden")},0)})}function fadeCurrentPage(){$(".main-wrapper").remove();$(".hony-wrapper").remove();$(".series-callout").remove();$("footer").remove();$(".share-modal-overlay").remove();$(".share-modal").remove();$(".mobile-navigation").remove();$(document.body).removeClass("show-share");renderWrapper()}function renderWrapper(){$template=$(HONY.templates["main-wrapper"]);$(document.body).append($template)}})();(function(){var postWidth=440;if($(window).width()<postWidth){postWidth=$(window).width()-30}var posts;var $postContainer;var scrollEventListener;var loading=false;var renderedIntro=false;var localOffset=0;var requestSize=12;var alreadyLoaded=0;HONY.HomeRenderer={};HONY.HomeRenderer.renderHome=function(){renderHeader();renderPostsContainer();renderNav();renderLatestSeries();renderSharer("Humans of New York began as a photography project in 2010. The initial goal was to photograph 10,000 New Yorkers on the street, and create an exhaustive catalogue of the cityâ€™s inhabitants.","https://s3.amazonaws.com/tholman.com/hony/meta-img/sharing-home.jpg","Humans of New York");renderFooter();if(alreadyLoaded>0){HONY.dataStore.getMainData(0,alreadyLoaded,renderPosts)}else{HONY.dataStore.getMainData(localOffset,requestSize,renderPosts)}};function tearDown(){}function scrollDown(){$("html, body").animate({scrollTop:window.innerHeight},700,"easeInOutQuart")}function loadMorePosts(){localOffset=$(".post").length;HONY.dataStore.getMainData(localOffset,requestSize,renderPosts)}var primaryText="The latest stories from HONY, featuring interviews with thousands of people on the streets of New York City.";var countriesText="Collected from trips to over twenty countries, these stories feature people from around the world.";var seriesText="These are collections of stories examining the experiences and challenges of certain populations.";var changingTimeout;function renderHeader(){var $template=$(HONY.templates["home-header"]);if(renderedIntro===false){$template.addClass("loading");$(document.body).addClass("hide-border")}$(".main-wrapper").append($template);renderHeaderBackgrounds($template);if(renderedIntro===false){setTimeout(function(){$(".home-header-intro").addClass("remove");setTimeout(function(){$template.removeClass("loading");$(".arrow").show();$(".home-header-intro").remove()},1100)},1800);renderedIntro=true}else{$(".arrow").show()}$(".stories-header, .arrow").click(function(event){event.preventDefault();scrollDown()});$(".countries-header").mouseover(function(){changeHeaderText(countriesText,$(".stories-header, .series-header"),$(this),1)});$(".series-header").mouseover(function(){changeHeaderText(seriesText,$(".stories-header, .countries-header"),$(this),2)});$(".series-header, .countries-header").mouseout(function(){changeHeaderText(primaryText,$(".series-header, .countries-header"),$(".stories-header"),0)})}function renderHeaderBackgrounds($template){var $panels=$(".split",$template);var items=["home","countries","series"];for(var j=0;j<$panels.length;j++){var $panel=$panels.eq(j);for(var i=0;i<items.length;i++){var $item=$('<div class="background-item type-'+items[i]+'"></div>');$item.css({"background-image":"url("+"https://s3.amazonaws.com/tholman.com/hony/img/"+items[i]+"-"+(j+1)+".jpg)"});$panel.append($item)}}}function changeHeaderBackgrounds(index){items=["home","countries","series"];$(".home-background").removeClass("home countries series");$(".home-background").addClass(items[index])}function changeHeaderText(text,$remove,$add,index){clearTimeout(changingTimeout);$(".nav-description .dot").css({transform:"translateY(-14px) scale(1)",opacity:.7});$(".nav-description p").css({opacity:0});changingTimeout=setTimeout(function(){$add.addClass("active");$remove.removeClass("active");changeHeaderBackgrounds(index);setTimeout(function(){$(".nav-description .dot").css({transform:"scale(1)",opacity:1});$(".nav-description p").text(text).css({opacity:1,transform:"translateY(0px)"})})},200)}function renderPostsContainer(){$containerHeader=$(HONY.templates["container-header"]);$(".main-wrapper").append($containerHeader);$postContainer=$(HONY.templates["home-posts-container"]);$(".main-wrapper").append($postContainer);$postContainer.isotope({masonry:{columnWidth:postWidth,isFitWidth:true,gutter:25},itemSelector:".post",hiddenStyle:{opacity:0},sortBy:"original-order"})}function renderPosts(posts){$(".load-container").remove();loading=false;for(var i=0;i<posts.length;i++){renderPost(posts[i])}alreadyLoaded=$(".post").length;renderLoadMoreButton()}function renderPost(post){var $post=$(HONY.templates["home-post"]);var image=new Image;var heightNumber=postWidth/post.photos[0].original_size.width*post.photos[0].original_size.height;image.style.height=heightNumber+"px";$(".post-image",$post).css({height:Math.floor(heightNumber)+"px"});$(".post-image",$post).append(image);$(".post-text",$post).append(post.caption.split("&ndash;")[0]);if(post.tags&&post.tags.length>0&&hasSeriesTag(post.tags)){var tag=hasSeriesTag(post.tags);var data=storyPageData[tag];var $tag=$('<a class="series-tag" href="/tagged/'+tag+'">'+tag+"</a>");$tag.css({"background-color":data.sectionColor});$tag.insertBefore($(".post-text",$post))}bindPost($post,post);if(FontDetect.isFontLoaded("Merriweather")){showItem(image,$postContainer,post,$post)}else{FontDetect.onFontLoaded("Merriweather",function(){showItem(image,$postContainer,post,$post)},function(){console.log("where is the font!")},{msTimeout:1e4})}}function showItem(image,$postContainer,post,$post){image.onload=function(){setTimeout(function(){$post.addClass("image-loaded")},50)};setTimeout(function(){image.src=post.photos[0].original_size.url},1);$postContainer.append($post).isotope("appended",$post,true)}function renderLoadMoreButton(){var $template=$("<div class='load-container'><span class='centerer'><div class='mask'><a class='special-button'><span class='background'></span>SHOW MORE STORIES</a></div></span></div>");$template.insertAfter($postContainer);$(".mask",$template).on("click",function(){$(this).addClass("active");loadMorePosts()})}function renderNav(){var $template=$(HONY.templates["home-navigation"]);$(".main-wrapper").append($template);checkFacebook();manageStickyNav()}function renderLatestSeries(){var $template=$(HONY.templates["series-footer"]);var keys=Object.keys(storyPageData);var series=storyPageData[keys[keys.length-1]];var key=keys[keys.length-1];var $seriesCallout=$(HONY.templates["series-callout"]);$seriesCallout.addClass("centered-callout left");$seriesCallout.css({"background-color":series["series-header-color"],"background-image":"url("+series["series-header"]+")"});$seriesCallout.addClass(series["style"]);if(series["style"]==="dark"){$("button",$seriesCallout).removeClass("light").addClass("dark");if(series["series-header-text-color"]==="#000"){$seriesCallout.addClass("special")}}$(".series-title",$seriesCallout).html(series["header"]);$(".series-title",$seriesCallout).css({color:series["series-header-text-color"]});$("button",$seriesCallout).click(function(event){event.preventDefault();$(document.body).addClass("fadeout");setTimeout(function(){var state={scrollTop:$(window).scrollTop()};window.history.replaceState(state,null,window.location.pathName);$("html, body").scrollTop(0);history.pushState(null,null,"/tagged/"+key.split(" ").join("-"));HONY.renderingController.render();$(document.body).removeClass("fadeout")},400)});$(".main-wrapper").append($template);$seriesCallout.insertAfter($template)}function renderFooter(){var $template=$(HONY.templates["hony-footer"]);$(".main-wrapper").append($template)}function bindPost($post,postData){$post.on("click",function(){tearDown();$(document.body).addClass("fadeout");setTimeout(function(){var state={scrollTop:$(window).scrollTop()};$("html, body").scrollTop(0);window.history.replaceState(state,null,window.location.pathName);history.pushState(null,null,"/post/"+postData.id+"/"+postData.slug);HONY.renderingController.renderPost(postData.id);$(document.body).removeClass("fadeout")},500)})}})();(function(){var postWidth=440;if($(window).width()<postWidth){postWidth=$(window).width()-30}var localOffset=0;var postData=null;var $postContainer;HONY.postRenderer={};HONY.postRenderer.renderPost=function(postId,country){localOffset=HONY.dataStore.getOffset(postId);if(localOffset===-1){localOffset=0}if(typeof country==="undefined"){country=HONY.dataStore.isCountryPost(postId)}if(typeof country==="undefined"||country===false){HONY.dataStore.getSinglePostData(postId,renderPost);HONY.dataStore.getMainRelavent(postId,renderRelaventPosts)}else{HONY.dataStore.getCountryPostData(postId,country,renderPost);HONY.dataStore.getCountryRelavent(postId,country,renderRelaventPosts)}};function renderPost(postData){renderPostHeader();renderNav();renderPostContent(postData);renderPostsContainer();renderSharer($(postData.caption).text(),postData.photos[0].original_size.url,"Humans of New York")}function renderPostHeader(){var $template=$(HONY.templates["post-page-header"]);$(".main-wrapper").append($template)}function renderPostContent(post){var $template=$(HONY.templates["post-page-post"]);$(".actual-image",$template).css({"background-image":"url("+post.photos[0].original_size.url+")"});$(".post-text",$template).html(post.caption);$(".main-wrapper").append($template);var $moreContainer=$('<div class="more-posts-container"></div>');$(".main-wrapper").append($moreContainer)}function renderPostsContainer(){$containerHeader=$(HONY.templates["container-header"]);$(".more-posts-container").append($containerHeader);$(".post-container-subheader",$containerHeader).text("MORE STORIES");$postContainer=$(HONY.templates["home-posts-container"]);$(".more-posts-container").append($postContainer);$postContainer.isotope({masonry:{columnWidth:postWidth,isFitWidth:true,gutter:25},itemSelector:".post",hiddenStyle:{},sortBy:"original-order"})}function renderRelaventPosts(postData){renderPosts(postData);renderFooter()}function renderPosts(postData){$(".load-container").remove();for(var i=0;i<postData.length;i++){renderMorePost(postData[i])}renderLoadMoreButton()}function renderLoadMoreButton(){var $template=$("<div class='load-container oddly-centered'><span class='centerer'><div class='mask'><a class='special-button'><span class='background'></span>SHOW MORE STORIES</a></div></span></div>");$template.insertAfter($postContainer);$(".mask",$template).on("click",function(){$(this).addClass("active");loadMorePosts()})}function loadMorePosts(){var offset=localOffset+$(".post").length+1;HONY.dataStore.getMainData(offset,12,renderPosts)}function renderNav(){var $template=$(HONY.templates["home-navigation"]);$(".main-wrapper").append($template);checkFacebook();manageStickyNav()}function renderMorePost(post){var $post=$(HONY.templates["home-post"]);var image=new Image;var heightNumber=postWidth/post.photos[0].original_size.width*post.photos[0].original_size.height;image.style.height=heightNumber+"px";$(".post-image",$post).css({height:Math.floor(heightNumber)+"px"});$(".post-image",$post).append(image);$(".post-text",$post).append(post.caption.split("&ndash;")[0]);if(post.tags&&post.tags.length>0&&hasSeriesTag(post.tags)){var tag=hasSeriesTag(post.tags);var data=storyPageData[tag];var $tag=$('<a class="series-tag" href="/tagged/'+tag+'">'+tag+"</a>");$tag.css({"background-color":data.sectionColor});$tag.insertBefore($(".post-text",$post))}var hasCountry=false;var postCountry=null;if(post.tags&&post.tags.length>0){for(var i=0;i<post.tags.length;i++){var tag=post.tags[i];for(var j=0;j<mapData.length;j++){var country=mapData[j][1];if(tag===country){postCountry=country;hasCountry=true;break}}}}if(hasCountry){bindPostWithCountry($post,post,country)}else{bindPost($post,post)}if(FontDetect.isFontLoaded("Merriweather")){showItem(image,$postContainer,post,$post)}else{FontDetect.onFontLoaded("Merriweather",function(){showItem(image,$postContainer,post,$post)},function(){console.log("where is the font!")},{msTimeout:1e4})}}function showItem(image,$postContainer,post,$post){image.onload=function(){setTimeout(function(){$post.addClass("image-loaded")},50)};setTimeout(function(){image.src=post.photos[0].original_size.url},1);$postContainer.append($post).isotope("appended",$post,true)}function tearDown(){}function bindPostWithCountry($post,postData,country){$post.on("click",function(){tearDown();$(document.body).addClass("fadeout");setTimeout(function(){var state={scrollTop:$(window).scrollTop()};$("html, body").scrollTop(0);window.history.replaceState(state,null,window.location.pathName);history.pushState(null,null,"/post/"+postData.id+"/"+postData.slug);HONY.renderingController.renderPost(postData.id,country);$(document.body).removeClass("fadeout")},500)})}function bindPost($post,postData){$post.on("click",function(){tearDown();$(document.body).addClass("fadeout");setTimeout(function(){var state={scrollTop:$(window).scrollTop()};$("html, body").scrollTop(0);window.history.replaceState(state,null,window.location.pathName);history.pushState(null,null,"/post/"+postData.id+"/"+postData.slug);HONY.renderingController.renderPost(postData.id);$(document.body).removeClass("fadeout")},500)})}function renderFooter(){var $template=$(HONY.templates["hony-footer"]);$(".main-wrapper").append($template)}})();(function(){var currentTag=null;var currentName=null;var postWidth=440;var $postContainer;var intervalA,intervalB;var name;var lastMapData=[];HONY.mapRenderer={};HONY.mapRenderer.render=function(){renderHeaderMap()};function renderHeader(){var $template=$(HONY.templates["post-page-header"]);$(".header-nav",$template).addClass("light").removeClass("dark");$(".left",$template).append($("<div class='tag'><span>Travel</span></div>"));$template.addClass("map-header").removeClass("post-page-header");$(".map-overlay").prepend($template)}function renderHeaderMap(){var $mapWrapper=$("<div class='map-wrapper'></div>");$(".main-wrapper").append($mapWrapper);$(".main-wrapper").addClass("countries-home");if(currentTag==null){currentName=mapData[0][0];currentTag=mapData[0][1];currentCountry=mapData[0][2]}renderMap();renderMapOverlay();renderHeader();renderPostsContainer();renderSharer("Collected from trips to over twenty countries, these stories feature people from around the world.","http://static.tumblr.com/kyy2zy0/Z4co6j1mu/social_sharing_countries.jpg","Humans of New York");renderFooter();renderNav();renderCountryCallouts()}function renderCountryCallouts(){for(var i=0;i<mapData.length;i++){var $countryItem=$("<div class='country-item'><div class='country-name-text'><span class='border inner-bottom'></span><span class='border inner-right'></span><span class='border inner-top'></span><span class='border inner-left'></span>"+mapData[i][0]+"</div><span class='country-face "+mapData[i][1].split(" ").join("-")+"'></span></div>");$countryItem.attr("tag",mapData[i][1]);$countryItem.attr("href","/tagged/"+mapData[i][1].split(" ").join("-"));$countryItem.click(function(e){e.preventDefault();var $this=$(this);$(document.body).addClass("fadeout");tearDown();setTimeout(function(){var state={scrollTop:$(window).scrollTop()};window.history.replaceState(state,null,window.location.pathName);$("html, body").scrollTop(0);history.pushState(null,null,"/tagged/"+$this.attr("tag").split(" ").join("-"));HONY.renderingController.render();$(document.body).removeClass("fadeout")},500)});$(".post-container").append($countryItem)}}function renderNav(){var $template=$(HONY.templates["home-navigation"]);$(".main-wrapper").append($template);checkFacebook();manageStickyNav()}function renderFooter(){var $template=$(HONY.templates["hony-footer"]);$(".main-wrapper").append($template)}function renderMap(){var zoom=d3.behavior.zoom().scaleExtent([0,9]);var width=document.querySelector(".map-wrapper").offsetWidth;var height=window.innerHeight;var topo,projection,path,svg,g;var graticule=d3.geo.graticule();setup(width,height);function setup(width,height){projection=d3.geo.mercator().translate([width/2,height/2+90]).scale(width/1.8/Math.PI);path=d3.geo.path().projection(projection);svg=d3.select(".map-wrapper").append("svg").attr("width",width).attr("height",height+8).call(zoom).append("g");g=svg.append("g")}d3.json("https://s3.amazonaws.com/tholman.com/hony/mapData.json",function(error,root){var world=root.files["world.json"].content;world=JSON.parse(world);var countries=topojson.feature(world,world.objects.countries).features;topo=countries;draw(topo);if(window.innerWidth>1e3){renderMapHeads();setTimeout(renderMapHeads,200);setTimeout(renderMapHeads,400);intervalA=setInterval(renderMapHeads,1200);intervalB=setInterval(renderMapHeads,1500)}else{renderMapHeads();setTimeout(renderMapHeads,400);intervalA=setInterval(renderMapHeads,1200)}});function draw(topo){var country=g.selectAll(".country").data(topo);country.enter().insert("path").attr("class",function(d,i){return"country country-"+d.properties.name.split(" ").join("").split(",").join("").toLowerCase()}).attr("d",path).attr("id",function(d,i){return d.id}).attr("title",function(d,i){return d.properties.name}).style("fill",function(d,i){return"#202020"})}function redraw(){var width=document.querySelector(".map-wrapper").offsetWidth;var height=window.innerHeight;d3.select(".map-wrapper svg").remove();setup(width,height);draw(topo)}function move(){var t=d3.event.translate;var s=d3.event.scale;zscale=s;var h=height/4;t[0]=Math.min(width/height*(s-1),Math.max(width*(1-s),t[0]));t[1]=Math.min(h*(s-1)+h*s,Math.max(height*(1-s)-h*s,t[1]));zoom.translate(t);g.attr("transform","translate("+t+")scale("+s+")");d3.selectAll(".country").style("stroke-width",1.5/s)}}function renderMapOverlay(){$(".main-wrapper").append($("<div class='map-overlay'><span class='shadow shadow-top'></span><span class='shadow shadow-bottom'></div>"));var $template=$(HONY.templates["map-header-main"]);$(".map-overlay").append($template)}function renderPostsContainer(){$postContainer=$(HONY.templates["home-posts-container"]);$postContainer.addClass("push-down");$postContainer.insertAfter($(".map-overlay"))}function renderLoadMoreButton(){var $template=$("<button class='load-more-button'><span></span>SHOW MORE STORIES</button>");$template.addClass("bottom-spacing");$template.insertAfter($postContainer);$template.on("click",function(){$(this).remove();loadMorePosts()})}function renderMapHeads(tried){var locations=["iranislamicrepublicof","pakistan","iraq","jordan","uganda","congothedemocraticrepublicofthe","southsudan","kenya","ukraine","india","vietnam","mexico","isreal"];var randomNumber=Math.floor(Math.random()*(locations.length-1));var random=locations[randomNumber];var selector=".country-"+random;var $location=$(selector);renderHead(randomNumber,$location.offset(),random,tried)}function renderHead(item,position,country,tried){var check=$(".head-"+country);if(check.length){if(tried!==true){renderMapHeads(true)}return}var $head=$('<div class="map-head"></div>');$head.addClass("head-"+country);var randomPostions=Math.round(Math.random())*60-30;

try{$head.css({left:Math.floor(position.left+randomPostions)+"px",top:Math.floor(position.top+randomPostions)+"px","background-position":-item*60+"px 0px"})}catch(e){tearDown();return}if(Math.random()<.5){if(item!==0){item=item-1}$head.addClass("type-two");$head.css({"background-position":-item*60+"px 0px"})}$head.one("webkitAnimationEnd oanimationend oAnimationEnd msAnimationEnd animationend",function(e){$(this).remove()});$(".map-wrapper").append($head)}function tearDown(){d3.select(window).on("resize",null);clearInterval(intervalA);clearInterval(intervalB);$("footer").remove()}function loadMorePosts(){var offset=$(".post").length;loadMapPosts(offset)}})();(function(){var currentTag=null;var currentName=null;var postWidth=440;if($(window).width()<postWidth){postWidth=$(window).width()-30}var $postContainer;var name;var lastMapData=[];HONY.countryRenderer={};HONY.countryRenderer.render=function(country){currentTag=country;currentName=countryNames[country];renderHeaderMap()};function renderHeader(){var $template=$(HONY.templates["post-page-header"]);$(".header-nav",$template);$(".left",$template).append($("<div class='tag'><span>Travel</span></div>"));$template.addClass("map-header").removeClass("post-page-header");$(".map-overlay").prepend($template)}function renderHeaderMap(){var $mapWrapper=$("<div class='map-wrapper light'></div>");$(".main-wrapper").append($mapWrapper);renderMap();renderMapOverlay();renderHeader();renderPostsContainer();renderSharer("Collected from trips to over twenty countries, these stories feature people from around the world.","http://static.tumblr.com/kyy2zy0/Z4co6j1mu/social_sharing_countries.jpg","Humans of New York");renderFooter();renderNav();HONY.dataStore.getCountryData(currentTag,function(data){renderPosts(data);renderCountryCallouts()})}function renderCountryCallouts(){var $countryBox=$('<div class="country-box"><div class="container-header"><h1 class="post-container-header">HUMANS OF NEW YORK</h1><h2 class="post-container-subheader">MORE COUNTRIES</h2></div><div class="the-countries"></div></div>');for(var i=0;i<mapData.length;i++){var $countryItem=$("<div class='country-item'><span>"+mapData[i][0]+"</span><span class='country-face "+mapData[i][1].split(" ").join("-")+"'></span></div>");$countryItem.attr("tag",mapData[i][1]);$countryItem.attr("href","/tagged/"+mapData[i][1].split(" ").join("-"));$countryItem.click(function(e){e.preventDefault();var $this=$(this);$(document.body).addClass("fadeout");setTimeout(function(){var state={scrollTop:$(window).scrollTop()};window.history.replaceState(state,null,window.location.pathName);$("html, body").scrollTop(0);history.pushState(null,null,"/tagged/"+$this.attr("tag").split(" ").join("-"));HONY.renderingController.render();$(document.body).removeClass("fadeout")},500)});$(".the-countries",$countryBox).append($countryItem)}$countryBox.insertAfter($(".post-container"))}function renderNav(){var $template=$(HONY.templates["home-navigation"]);$(".main-wrapper").append($template);checkFacebook();manageStickyNav()}function renderFooter(){var $template=$(HONY.templates["hony-footer"]);$(".main-wrapper").append($template)}function renderMap(){var zoom=d3.behavior.zoom().scaleExtent([0,9]);var width=document.querySelector(".map-wrapper").offsetWidth;var height=window.innerHeight;var topo,projection,path,svg,g;var graticule=d3.geo.graticule();setup(width,height);function setup(width,height){projection=d3.geo.mercator().translate([width/2,height/2+90]).scale(width/1.8/Math.PI);path=d3.geo.path().projection(projection);svg=d3.select(".map-wrapper").append("svg").attr("width",width).attr("height",height+8).call(zoom).append("g");g=svg.append("g")}d3.json("https://s3.amazonaws.com/tholman.com/hony/mapData.json",function(error,root){var world=root.files["world.json"].content;world=JSON.parse(world);var countries=topojson.feature(world,world.objects.countries).features;topo=countries;draw(topo)});function draw(topo){var country=g.selectAll(".country").data(topo);country.enter().insert("path").attr("class",function(d,i){return"country country-"+d.properties.name.split(" ").join("").split(",").join("").toLowerCase()}).attr("d",path).attr("id",function(d,i){return d.id}).attr("title",function(d,i){return d.properties.name}).style("fill",function(d,i){return"#EEEFF0"})}}function renderMapOverlay(){$(".main-wrapper").append($("<div class='map-overlay light'><span class='shadow shadow-top'></span><span class='shadow shadow-bottom'></div>"));var $template=$("<div class='country-header-title'>"+currentName+"</div>");$(".map-overlay").append($template)}function renderPostsContainer(){$postContainer=$(HONY.templates["home-posts-container"]);$postContainer.addClass("pull-up");$postContainer.insertAfter($(".map-overlay"));$postContainer.isotope({masonry:{columnWidth:postWidth,isFitWidth:true,gutter:25},itemSelector:".post",hiddenStyle:{},sortBy:"original-order"})}function renderPosts(posts){for(var i=0;i<posts.length;i++){renderPost(posts[i])}}function renderPost(post){var $post=$(HONY.templates["home-post"]);var image=new Image;image.src=post.photos[0].original_size.url;var heightNumber=postWidth/post.photos[0].original_size.width*post.photos[0].original_size.height;image.style.height=heightNumber+"px";$(".post-image",$post).css({height:Math.floor(heightNumber)+"px"});$(".post-image",$post).append(image);$(".post-text",$post).append(post.caption.split("&ndash;")[0]);bindPost($post,post);if(FontDetect.isFontLoaded("Merriweather")){showItem(image,$postContainer,post,$post)}else{FontDetect.onFontLoaded("Merriweather",function(){showItem(image,$postContainer,post,$post)},function(){console.log("where is the font!")},{msTimeout:1e4})}}function showItem(image,$postContainer,post,$post){image.onload=function(){setTimeout(function(){$post.addClass("image-loaded")},50)};setTimeout(function(){image.src=post.photos[0].original_size.url},1);$postContainer.append($post).isotope("appended",$post,true)}function tearDown(){d3.select(window).on("resize",null);$("footer").remove()}function bindPost($post,postData){$post.on("click",function(){tearDown();$(document.body).addClass("fadeout");setTimeout(function(){var state={scrollTop:$(window).scrollTop()};$("html, body").scrollTop(0);window.history.replaceState(state,null,window.location.pathName);history.pushState(null,null,"/post/"+postData.id+"/"+postData.slug);HONY.renderingController.renderPost(postData.id,currentTag);$(document.body).removeClass("fadeout")},500)})}})();(function(){HONY.seriesHomeRenderer={};HONY.seriesHomeRenderer.render=function(){renderHeader();renderSeriesHeader();renderSeries();renderSharer("Check out these amazing series");renderFooter();renderNav()};function renderHeader(){var $template=$(HONY.templates["post-page-header"]);$(".main-wrapper").append($template)}function renderSeriesHeader(){var $template=$(HONY.templates["series-home-header"]);$(".main-wrapper").append($template)}function renderNav(){var $template=$(HONY.templates["home-navigation"]);$(".main-wrapper").append($template);checkFacebook();manageStickyNav()}function renderSeries(post){var seriesData=storyPageData;var keys=Object.keys(seriesData).reverse();for(var i=0;i<keys.length;i++){(function closure(){var series=seriesData[keys[i]];var name=keys[i];var $seriesCallout=$(HONY.templates["series-callout"]);$seriesCallout.addClass("centered-callout");$seriesCallout.addClass(series["series-align"]);$seriesCallout.css({"background-color":series["series-header-color"],"background-image":"url("+series["series-header"]+")"});$(".series-title",$seriesCallout).html(series["header"]);$(".series-title",$seriesCallout).css({color:series["series-header-text-color"]});$seriesCallout.addClass(series["style"]);if(series["style"]==="dark"){$("button",$seriesCallout).removeClass("light").addClass("dark");if(series["series-header-text-color"]==="#000"){$seriesCallout.addClass("special")}}$("button",$seriesCallout).click(function(event){event.preventDefault();$(document.body).addClass("fadeout");setTimeout(function(){var state={scrollTop:$(window).scrollTop()};window.history.replaceState(state,null,window.location.pathName);$("html, body").scrollTop(0);history.pushState(null,null,"/tagged/"+name.split(" ").join("-"));HONY.renderingController.render();$(document.body).removeClass("fadeout")},400)});$(".main-wrapper").append($seriesCallout);$seriesCallout.addClass("centered-callout")})()}}function renderFooter(){var $template=$(HONY.templates["hony-footer"]);$(".main-wrapper").append($template)}})();HONY.storiesRenderer={};var $body;var $base;var templates=HONY.templates;var tag="";var month_names=["January","February","March","April","May","June","July","August","September","October","November","December"];var storyData;var storyApiURL="https://be1uo0y30d.execute-api.us-east-1.amazonaws.com/prod/data?limit=50&tag=";var posts;var cacheVersion=1;var localData=null;HONY.storiesRenderer.render=function(){var paths=location.pathname.split("/");if($.inArray("tagged",paths)!==-1){tag=paths[paths.length-1].split("-").join(" ")}storyData=storyPageData[tag];$body=$(document.body);var storageGet=localStorage.getItem("HONY-SERIES");if(storageGet){localData=JSON.parse(storageGet);if(!localData["cacheVersion"]||localData["cacheVersion"]!==cacheVersion){console.log("out of date cache, get data again!");localStorage.removeItem("HONY-SERIES");localData="";getData();return}else{localData["cacheVersion"]=cacheVersion;localStorage.setItem("HONY-SERIES",JSON.stringify(localData))}if(localData[tag]&&localData[tag].length){posts=localData[tag];figureOutRender()}else{getData()}}else{getData()}};var doubleFetch;function getData(){var url=storyApiURL+tag.split(" ").join("-");$.ajax({url:url,dataType:"jsonp",success:function(data){console.log(data);if(data.response.total_posts!==data.response.posts.length){doubleFetch=data.response.posts;getMorePostData(data.response.posts.length);return}posts=parsePosts(data);if(localData){localData[tag]=posts}else{localData={};localData[tag]=posts}localData["cacheVersion"]=cacheVersion;localStorage.setItem("HONY-SERIES",JSON.stringify(localData));figureOutRender()},error:function(data){console.log("error: ",data)}})}function getMorePostData(offset){var url=storyApiURL+tag.split(" ").join("-");newURL=url+"&offset="+offset;console.log(newURL);$.ajax({url:newURL,dataType:"jsonp",success:function(data){console.log("getting more posts!");data.response.posts=doubleFetch.concat(data.response.posts);posts=parsePosts(data);if(localData){localData[tag]=posts}else{localData={};localData[tag]=posts}localData["cacheVersion"]=cacheVersion;localStorage.setItem("HONY-SERIES",JSON.stringify(localData));figureOutRender()},error:function(data){console.log("error: ",data)}})}function figureOutRender(){$(".main-wrapper").remove();$("footer").remove();if(window.location.hash){try{var page=parseInt(window.location.hash.substring(1));renderStoryPage(page)}catch(e){renderPage(posts)}}else{renderPage(posts)}}function containsFormattingTag(array){var openingTags=["1/2","1/3","1/4","1/5","1/6","1/7","1/8","1/9","1/10","1/11","1/12","1/13","1/14","1/15"];var closingTags=["2/2","3/3","4/4","5/5","6/6","7/7","8/8","9/9","10/10","11/11","12/12","13/13","14/14","15/15"];for(var i=0;i<openingTags.length;i++){if(array.indexOf(openingTags[i])!==-1){return"opening"}}for(var i=0;i<closingTags.length;i++){if(array.indexOf(closingTags[i])!==-1){return"closing"}}return false}function parsePosts(data){var organizedPosts=[];var posts=data.response.posts.reverse();var set=null;for(var i=0;i<posts.length;i++){var postData=posts[i];var containsTags=containsFormattingTag(postData.tags);if(containsTags==="opening"){set=[];set.push(postData)}else if(containsTags==="closing"){set.push(postData);organizedPosts.push(set);set=null}else{if(set){set.push(postData)}else{organizedPosts.push(postData)}}}return organizedPosts}function renderPage(posts){renderRoot(posts)}function renderRoot(posts,sectionData){renderBase();renderHeader();renderRootPostContainer();renderRootPosts(posts);renderShareButton("SHARE THIS SERIES");renderStickyNav();renderSharer($(".series-teaser").text(),storyData.headerImage,capitalizeEachWord(tag.split("+").join(" ")));renderLatestSeries();renderFooter()}function renderStoryPage(entry){$(".main-wrapper").remove();$("footer").remove();var postData=posts[entry];var sectionData=storyData.sectionData[entry];renderBase();renderStoryHeader(postData,sectionData);renderStoryPosts(postData,sectionData);renderShareButton("SHARE THIS STORY");renderReadMore(posts);renderStickyNav();var photo;if(postData.length){photo=postData[0].photos[0].original_size.url}else{photo=postData.photos[0].original_size.url}renderSharer('"'+sectionData.quote+'"',photo,capitalizeEachWord(tag.split("+").join(" ")));renderFooter()}function renderLatestSeries(){var keys=Object.keys(storyPageData);var key;var currentKeyIndex=keys.indexOf(tag);if(currentKeyIndex==0){series=storyPageData[keys[keys.length-1]];key=keys[keys.length-1]}else{series=storyPageData[keys[currentKeyIndex-1]];key=keys[currentKeyIndex-1]}var $seriesCallout=$(HONY.templates["series-callout"]);$seriesCallout.addClass("centered-callout");$seriesCallout.addClass(series["series-align"]);$seriesCallout.css({"background-color":series["series-header-color"],"background-image":"url("+series["series-header"]+")"});$seriesCallout.addClass(series["style"]);if(series["style"]==="dark"){$("button",$seriesCallout).removeClass("light").addClass("dark");if(series["series-header-text-color"]==="#000"){$seriesCallout.addClass("special")}}$(".series-title",$seriesCallout).html(series["header"]);$(".series-title",$seriesCallout).css({color:series["series-header-text-color"]});$("button",$seriesCallout).click(function(){history.pushState(null,null,"/tagged/"+key.split(" ").join("-"));HONY.renderingController.render()});$(".main-wrapper").append($seriesCallout)}function renderStoryHeader(postData,sectionData){var $header=$(templates["story-header"]);$(".story-header-text",$header).html("&ldquo;"+sectionData.quote+"&rdquo;");$(".left",$header).append($("<div class='tag'><span>"+tag.split(" ")[0]+"</span><span>"+tag.split(" ")[1]+"</span></div>"));$(".tag",$header).css({color:sectionData.sectionColor});$(".hony",$header).attr("href","/series");var dateString=postData.date||postData[0].date;var date=new Date(dateString.replace(/-/g,"/"));var month=month_names[date.getMonth()];var year=date.getFullYear();$(".story-header-location",$header).text(month+" "+year+": "+sectionData.place);$base.append($header)}function renderStoryPosts(postData,sectionData){var post;if(postData.length){for(var i=0;i<postData.length;i++){renderStoryPost(postData[i],"("+(i+1)+"/"+postData.length+")","("+sectionData.place+")",i)}}else{renderStoryPost(postData)}}function renderStoryPost(postData,stripNumber,stripPlace,item){var $post=$(templates["story-post"]);$(".actual-image",$post).css({"background-image":"url("+postData.photos[0].original_size.url+")"});if(item>=1){$(".story-post-image",$post).addClass("smaller")}var caption=postData.caption;caption=caption.replace(stripNumber,"");caption=caption.replace(stripPlace,"");caption=caption.replace("(&frac12;)","");caption=caption.replace("(&frac14;)","");caption=caption.replace("(&frac24;)","");caption=caption.replace("(&frac34;)","");caption=caption.split("&ndash;")[0];caption=caption.split("&mdash;&ndash;")[0];$(".story-post-text",$post).html(caption);$base.append($post)}function renderRootPosts(posts){for(var i=0;i<posts.length;i++){var postData=posts[i];var sectionData=storyData.sectionData[i];var post;if(postData.length){if(sectionData.photo){post=postData[sectionData.photo-1]}else{post=postData[0]}}else{post=postData}renderRootPost(post,storyData.sectionData[i],i%2,i)}}function renderReadMore(posts){var $template=$(templates["read-more-stories"]);for(var i=0;i<posts.length;i++){var postData=posts[i];var sectionData=storyData.sectionData[i];var post;if(postData.length){if(sectionData.photo){post=postData[sectionData.photo-1]}else{post=postData[0]}}else{post=postData}var $post=renderRootPost(post,sectionData,null,i,true);$(".read-more-stories-container",$template).append($post)}$base.append($template)}function renderStickyNav(){var $template=$(templates["home-navigation"]);$base.append($template);manageStickyNav();try{FB.XFBML.parse()}catch(e){}}function renderRootPost(postData,sectionData,column,entry,returnItem){console.log("render root post",postData,sectionData);var photo=postData.photos[0].original_size.url;var $template=$(templates["root-post"]);var $columns=[$(".left-column-container"),$(".right-column-container")];$(".root-post-actual-image",$template).css({"background-image":"url("+photo+")","border-color":sectionData.color});$(".root-post-image",$template).css({"border-color":sectionData.color});$(".root-post-location",$template).text(sectionData.place);$(".root-post-quote",$template).html("&ldquo;"+sectionData.quote+"&rdquo;");$(".root-post-read, .root-post-image",$template).click(function(){$(document.body).addClass("fadeout");setTimeout(function(){var state={scrollTop:$(window).scrollTop()};window.history.replaceState(state,null,window.location.pathName);$("html, body").scrollTop(0);history.pushState(state,null,"#"+entry);renderStoryPage(entry);$(document.body).removeClass("fadeout")},400)});if(returnItem){return $template}else{$columns[column].append($template)}}function renderBase(){$(".main-wrapper").remove();$template=$(HONY.templates["main-wrapper"]);$(document.body).append($template);$base=$(".main-wrapper")}function renderHeader(sectionData){var $header=$(templates["stories-header"]);$(".header-image",$header).css({"background-image":"url("+storyData.headerImage+")"});$header.addClass(storyData.style);$(".header-nav",$header).addClass(storyData.style);$(".series-title",$header).html(storyData.header);$(".series-teaser",$header).html(storyData.headerSynopsis);$(".left",$header).append($("<div class='tag'><span>"+tag.split(" ")[0]+"</span><span>"+tag.split(" ")[1]+"</span></div>"));$(".hony",$header).attr("href","/series");$(".tag",$header).css({color:storyData.sectionColor});$(".header-dot",$header).css({background:storyData.sectionColor});$(".arrow",$header).click(function(){$("html, body").animate({scrollTop:$(".leadin").offset().top},700,"easeInOutQuart")});$base.append($header);var currentData=storyPageData[tag];var $leadIn=$(templates["lead-in"]);$(".leadin-text",$leadIn).text(currentData.leadInText);$base.append($leadIn)}function renderRootPostContainer(){$base.append($("<section class='post-container'><div class='left-column-container'></div><div class='right-column-container'></div></section>"))}function renderShareButton(text){var $template=$("<button class='share-button'>"+text+"<span></span></div>");$(".main-wrapper").append($template)}function renderFooter(){$body.append($(templates["hony-footer"]))}var iframe;(function(){HONY.aboutRenderer={};HONY.aboutRenderer.render=function(){renderHeader();renderSharer("Humans of New York began as a photography project in 2010. The initial goal was to photograph 10,000 New Yorkers on the street, and create an exhaustive catalogue of the cityâ€™s inhabitants.","https://s3.amazonaws.com/tholman.com/hony/meta-img/sharing-home.jpg","Humans of New York");var $template=$(HONY.templates["about-main"]);$(".main-wrapper").append($template);renderFooter();renderNav();setTimeout(function(){addIframe()},1)};function addIframe(){$('<iframe src="https://player.vimeo.com/video/85667490" width="1170" height="655" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>').appendTo(".about-video")}function renderHeader(){var $template=$(HONY.templates["post-page-header"]);$(".main-wrapper").append($template)}function renderFooter(){var $template=$(HONY.templates["hony-footer"]);$(".main-wrapper").append($template)}function renderNav(){var $template=$(HONY.templates["home-navigation"]);$(".main-wrapper").append($template);checkFacebook();manageStickyNav()}})();